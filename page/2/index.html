<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|0.8:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/blog/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/blog/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tramac.github.io","root":"/blog/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Tramac写字的地方">
<meta property="og:type" content="website">
<meta property="og:title" content="Tramac&#39;s Space">
<meta property="og:url" content="http://tramac.github.io/page/2/index.html">
<meta property="og:site_name" content="Tramac&#39;s Space">
<meta property="og:description" content="Tramac写字的地方">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Tramac">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://tramac.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Tramac's Space</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/blog/atom.xml" title="Tramac's Space" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/tramac" target="_blank" rel="noopener">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
      src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" 
      alt="Fork me on GitHub" 
      data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
    </a>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tramac's Space</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Keep trying</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tramac.github.io/2020/07/17/%E7%AC%AC3%E7%AB%A0%20%E5%88%9D%E6%8E%A2OpenCV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Tramac">
      <meta itemprop="description" content="Tramac写字的地方">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tramac's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/07/17/%E7%AC%AC3%E7%AB%A0%20%E5%88%9D%E6%8E%A2OpenCV/" class="post-title-link" itemprop="url">第3章 初探OpenCV</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-17 14:19:46 / 修改时间：16:22:34" itemprop="dateCreated datePublished" datetime="2020-07-17T14:19:46+08:00">2020-07-17</time>
            </span>

          
            <span id="/blog/2020/07/17/%E7%AC%AC3%E7%AB%A0%20%E5%88%9D%E6%8E%A2OpenCV/" class="post-meta-item leancloud_visitors" data-flag-title="第3章 初探OpenCV" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="OpenCV的基本数据类型"><a href="#OpenCV的基本数据类型" class="headerlink" title="OpenCV的基本数据类型"></a>OpenCV的基本数据类型</h4><ul>
<li><strong>基本数据类型</strong></li>
</ul>
<table>
<thead>
<tr>
<th align="left">结构</th>
<th align="left">成员</th>
<th align="left">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CvPoint</td>
<td align="left">int x, y</td>
<td align="left">图像中的点</td>
</tr>
<tr>
<td align="left">CvPoint2D32f</td>
<td align="left">float x, y</td>
<td align="left">二维空间中的点</td>
</tr>
<tr>
<td align="left">CvPoint3D32f</td>
<td align="left">float x, y， z</td>
<td align="left">三维空间中的点</td>
</tr>
<tr>
<td align="left">CvSize</td>
<td align="left">int width, height</td>
<td align="left">图像的尺寸</td>
</tr>
<tr>
<td align="left">CvRect</td>
<td align="left">int x, y, width, height</td>
<td align="left">图像的部分区域</td>
</tr>
<tr>
<td align="left">CvScalar</td>
<td align="left">double val[4]</td>
<td align="left">RGBA值</td>
</tr>
</tbody></table>
<h4 id="CvMat矩阵结构"><a href="#CvMat矩阵结构" class="headerlink" title="CvMat矩阵结构"></a>CvMat矩阵结构</h4><p>在OpenCV中没有向量（vector）结构，需要时可以用列矩阵代替。<br>矩阵由宽度（width），高度（height），类型（type），行数据长度（step）和一个指向数据的指针构成。</p>
<ul>
<li><strong>矩阵头的定义</strong>：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">typeded <span class="class"><span class="keyword">struct</span> <span class="title">CvMat</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">step</span>;</span><br><span class="line">    <span class="keyword">int</span>* refcount;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        unchar* ptr;</span><br><span class="line">        short* s;</span><br><span class="line">        <span class="keyword">int</span>* i;</span><br><span class="line">        <span class="keyword">float</span>* fl;</span><br><span class="line">        <span class="keyword">double</span>* db;</span><br><span class="line">    &#125;data;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> rows;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">height</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> cols;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">width</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125; CvMat;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>矩阵的创建与释放</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CvMat* <span class="title">cvCreateMat</span><span class="params">(<span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">int</span> type)</span></span>; </span><br><span class="line"><span class="function">CvMat* <span class="title">cvCreateMatHeader</span><span class="params">(<span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">int</span> type)</span></span>; <span class="comment">//只创建CvMat结构，不分配存储空间</span></span><br><span class="line"><span class="function">CvMat* <span class="title">cvInitMatHeader</span><span class="params">(CvMat* mat, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">int</span> type, <span class="keyword">void</span>* data=<span class="literal">NULL</span>, <span class="keyword">int</span> <span class="built_in">step</span>=CV_AUTOSTEP)</span></span>; <span class="comment">//在已存在的结构上初始化CvMat矩阵头</span></span><br><span class="line"><span class="function">CvMat* <span class="title">cvCloneMat</span><span class="params">(<span class="keyword">const</span> CvMat* mat)</span></span>; <span class="comment">// 克隆</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvReleaseMat</span><span class="params">(CvMat** mat)</span></span>; <span class="comment">// 释放</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>矩阵数据的存取</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> element_3_2 = CV_MAT_ELEM(*mat, <span class="keyword">float</span>, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"><span class="function">uchar* <span class="title">cvPtr2D</span><span class="params">(<span class="keyword">const</span> CvArr* arr, <span class="keyword">int</span> idx0, <span class="keyword">int</span> idx1, <span class="keyword">int</span>* type=<span class="literal">NULL</span>)</span></span>; <span class="comment">// 返回指向所需元素的指针</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cvGetReal2D</span><span class="params">(<span class="keyword">const</span> CvArr* arr, <span class="keyword">int</span> indx0, <span class="keyword">int</span> idx1)</span></span>; <span class="comment">// 返回矩阵元素的实际值</span></span><br><span class="line"><span class="function">CvScalar <span class="title">cvGet2D</span><span class="params">(<span class="keyword">const</span> CvArr* arr, <span class="keyword">int</span> idx0, <span class="keyword">int</span> idx1)</span></span>; <span class="comment">// 返回CvScalar类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSetReal2D</span><span class="params">(CvArr* arr, <span class="keyword">int</span> idx0, <span class="keyword">int</span> idx1, <span class="keyword">double</span> value)</span></span>; <span class="comment">// 设置值</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSet2D</span><span class="params">(CvArr* arr, <span class="keyword">int</span> idx0, <span class="keyword">int</span> idx1, CvScalar value)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="IplImage数据结构"><a href="#IplImage数据结构" class="headerlink" title="IplImage数据结构"></a>IplImage数据结构</h4><ul>
<li><strong>IplImage结构</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IplImage</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> nSize;</span><br><span class="line">    <span class="keyword">int</span> ID;</span><br><span class="line">    <span class="keyword">int</span> nChannels;</span><br><span class="line">    <span class="keyword">int</span> alphaChannel;</span><br><span class="line">    <span class="keyword">int</span> depth;</span><br><span class="line">    <span class="keyword">char</span> colorModel[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">char</span> dataOrder;</span><br><span class="line">    <span class="keyword">int</span> origin;</span><br><span class="line">    <span class="keyword">int</span> align;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">width</span>;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">height</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IplROI</span> *<span class="title">roi</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IplImage</span> *<span class="title">maskROI</span>;</span></span><br><span class="line">    <span class="keyword">void</span> *imageId;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IplTileInfo</span> *<span class="title">tileInfo</span>;</span></span><br><span class="line">    <span class="keyword">int</span> imageSize;</span><br><span class="line">    <span class="keyword">char</span> *imageData;</span><br><span class="line">    <span class="keyword">int</span> widthStep;</span><br><span class="line">    <span class="keyword">int</span> BorderMode[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">int</span> BorderConst[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">char</span> *imageDataOrigin;</span><br><span class="line">&#125; IplImage;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ROI的设置与重置</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvSetImageROI</span><span class="params">(IplImage* <span class="built_in">image</span>, CvRect <span class="built_in">rect</span>)</span></span>; <span class="comment">// 设置ROI</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvResetImageROI</span><span class="params">(IplImage* <span class="built_in">image</span>)</span></span>; <span class="comment">// 取消ROI</span></span><br></pre></td></tr></table></figure>

<h4 id="画图"><a href="#画图" class="headerlink" title="画图"></a>画图</h4><ul>
<li><strong>直线</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvLine</span><span class="params">(CvArr* <span class="built_in">array</span>, CvPoint pt1, CvPoint pt2, CvScalar color, <span class="keyword">int</span> thickness=<span class="number">1</span>, <span class="keyword">int</span> connectivity=<span class="number">8</span>)</span></span>; <span class="comment">// 直线</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvRectangle</span><span class="params">(CvArr* <span class="built_in">array</span>, CvPoint pt1, CvPoint pt2, CvScalar color, <span class="keyword">int</span> thickness=<span class="number">1</span>)</span></span>; <span class="comment">// 矩形</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>圆形和椭圆</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvCircle</span><span class="params">(CvArr* <span class="built_in">array</span>, CvPoint center, <span class="keyword">int</span> radius, CvScalar color, <span class="keyword">int</span> thickness=<span class="number">1</span>, <span class="keyword">int</span> connectivity=<span class="number">8</span>)</span></span>; <span class="comment">// 圆形</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvEllipse</span><span class="params">(CvArr* img, CvPoint center, CvSize axes, <span class="keyword">double</span> angle, <span class="keyword">double</span> start_angle, <span class="keyword">double</span> end_angle, CvScalar color, <span class="keyword">int</span> thickness=<span class="number">1</span>, <span class="keyword">int</span> line_type=<span class="number">8</span>)</span></span>; <span class="comment">// 椭圆</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>多边形</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvFillPoly</span><span class="params">(CvArr* img, CvPoint** pts, <span class="keyword">int</span>* npts, <span class="keyword">int</span> contours, CvScalar color, <span class="keyword">int</span> line_type=<span class="number">8</span>)</span></span>; <span class="comment">// 多边形</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>字体和文字</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cvPutText</span><span class="params">(CvArr* img, <span class="keyword">const</span> <span class="keyword">char</span>* <span class="built_in">text</span>, CvPoint origin, <span class="keyword">const</span> CvFont* font, CvScalr color)</span></span>; <span class="comment">// 图像上输出文本</span></span><br></pre></td></tr></table></figure>

<h4 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h4><ul>
<li><strong>矩阵的存储和读取</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CvMat A = cvMat(<span class="number">5</span>, <span class="number">5</span>, CV_32F, the_matrix_data); <span class="comment">// 创建矩阵</span></span><br><span class="line">cvSave(<span class="string">"my_matrix.xml"</span>, &amp;A); <span class="comment">// 存储矩阵</span></span><br><span class="line">CvMat* A1 = (CvMat*) cvLoad(<span class="string">"my_matrix.xml"</span>); <span class="comment">// 读取矩阵</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>xml格式文件的新建，存储与读取</strong></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tramac.github.io/2020/07/17/%E7%AC%AC2%E7%AB%A0%20OpenCV%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Tramac">
      <meta itemprop="description" content="Tramac写字的地方">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tramac's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/07/17/%E7%AC%AC2%E7%AB%A0%20OpenCV%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">第2章 OpenCV入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-17 14:18:47 / 修改时间：16:21:46" itemprop="dateCreated datePublished" datetime="2020-07-17T14:18:47+08:00">2020-07-17</time>
            </span>

          
            <span id="/blog/2020/07/17/%E7%AC%AC2%E7%AB%A0%20OpenCV%E5%85%A5%E9%97%A8/" class="post-meta-item leancloud_visitors" data-flag-title="第2章 OpenCV入门" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="OpenCV的结构和内容"><a href="#OpenCV的结构和内容" class="headerlink" title="OpenCV的结构和内容"></a>OpenCV的结构和内容</h4><p>OpenCV主体分为五个模块：</p>
<ul>
<li>CV模块：包含基本的图像处理函数和高级的计算机视觉算法。</li>
<li>ML库：机器学习库，包含一些基于统计的分类和聚类工具。</li>
<li>HighGUI：包含图像和视频输入/输出的函数。</li>
<li>CXCore：包含OpenCV的一些基本数据结构和相关函数。</li>
<li>CvAux模块：存放一些即将被淘汰的算法和函数。</li>
</ul>
<h4 id="显示图像"><a href="#显示图像" class="headerlink" title="显示图像"></a>显示图像</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv/cv.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv/highgui.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    IplImage *img = cvLoadImage(<span class="string">"./Lena.jpg"</span>);</span><br><span class="line">    cvNamedWindow(<span class="string">"Example1"</span>, CV_WINDOW_AUTOSIZE);</span><br><span class="line">    cvShowImage(<span class="string">"Example1"</span>, img);</span><br><span class="line">    cvWaitKey(<span class="number">0</span>);</span><br><span class="line">    cvReleaseImage(&amp;img);</span><br><span class="line">    cvDestroyWindow(<span class="string">"Example1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>cvLoadImage()</code>函数可读取绝大多数格式类型的图像文件，包括BMP,DIB,JPEG,JPE,PNG,PBM,TIFF等。该函数执行后返回一个指针，此指针指向一块为描述该图像文件的数据结构（IplImage）而分配的内存块。</p>
<h4 id="简单的变换"><a href="#简单的变换" class="headerlink" title="简单的变换"></a>简单的变换</h4><p>实现变换的方式：新建一个IplImage结构，然后对原图执行某种操作，将结构写入到新建的结构中，返回。<br>新建IplImage的方式：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IplImage* out = cvCreateImage(</span><br><span class="line">    cvSize(in-&gt;<span class="built_in">width</span> / <span class="number">2</span>, in-&gt;<span class="built_in">height</span> / <span class="number">2</span>),</span><br><span class="line">    in-&gt;depth,</span><br><span class="line">    in-&gt;nChannels);</span><br></pre></td></tr></table></figure>



<p>分配新的图像空间时是从旧的图像中读取所需的信息。在OpenCV中，所有的重要的数据都是以数据体的形式实现，并且以数据体指针的形式传递。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tramac.github.io/2020/07/17/%E5%AD%A6%E4%B9%A0OpenCV%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Tramac">
      <meta itemprop="description" content="Tramac写字的地方">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tramac's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/07/17/%E5%AD%A6%E4%B9%A0OpenCV%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" class="post-title-link" itemprop="url">学习OpenCV环境准备</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-17 14:17:51 / 修改时间：16:30:29" itemprop="dateCreated datePublished" datetime="2020-07-17T14:17:51+08:00">2020-07-17</time>
            </span>

          
            <span id="/blog/2020/07/17/%E5%AD%A6%E4%B9%A0OpenCV%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" class="post-meta-item leancloud_visitors" data-flag-title="学习OpenCV环境准备" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="OpenCV配置"><a href="#OpenCV配置" class="headerlink" title="OpenCV配置"></a>OpenCV配置</h4><p>由于我的Ubuntu 16.04不知道什么时候已经安装了OpenCV，所以这里省略了安装过程。注意的是我的OpenCV应该不是按照官网的编译方式安装的，应该是之前有一些环境配置时所需依赖时以其他的方式安装的。</p>
<ul>
<li>使用vs code编译OpenCV程序</li>
</ul>
<p>在vs code编译器中，用简单的读取图片的代码测试，运行时出现下面错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/tmp/cc9zYXpi.o: In function 'main':</span><br><span class="line">/home/xxx/c++/main.cpp:5: undefined reference to 'cvLoadImage'</span><br><span class="line">/home/xxx/c++/main.cpp:6: undefined reference to 'cvNamedWindow'</span><br><span class="line">/home/xxx/c++/main.cpp:7: undefined reference to 'cvShowImage'</span><br><span class="line">/home/xxx/c++/main.cpp:8: undefined reference to 'cvWaitKey'</span><br><span class="line">/home/xxx/c++/main.cpp:9: undefined reference to 'cvReleaseImage'</span><br><span class="line">/home/xxx/c++/main.cpp:10: undefined reference to 'cvDestroyWindow'</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">The terminal process terminated with exit code: 1</span><br></pre></td></tr></table></figure>



<p>我对于该错误出现的推测是，因为测试程序是在之前配置运行c++的环境下运行的，所以设置的默认编译指令也是用的之前的，所以对于当前的并不适用，应该需要对于OpenCV所需的指令重新设定默认编译指令。</p>
<ul>
<li>一种在终端编译的方式</li>
</ul>
<p>在vs code中由于设置的问题出现报错，那有一种通用的方式是在终端输入命令行完成编译。命令行如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cpp -o main_out `pkg-config --cflags --libs opencv`</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：这里是`而不是‘，否则无法编译成功。</p>
<p><code>pkg-config</code>可用于列举某个库的相关信息，比如此库的路径/相关头文件等。比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ pkg-config --cflags opencv</span><br><span class="line">-I/usr/include/opencv</span><br><span class="line"></span><br><span class="line">~$ pkg-config --libs opencv</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libopencv_calib3d.so -lopencv_calib3d /usr/lib/x86_64-linux-gnu/libopencv_contrib.so -lopencv_contrib /usr/lib/x86_64-linux-gnu/libopencv_core.so -lopencv_core /usr/lib/x86_64-linux-gnu/libopencv_features2d.so -lopencv_features2d /usr/lib/x86_64-linux-gnu/libopencv_flann.so -lopencv_flann /usr/lib/x86_64-linux-gnu/libopencv_gpu.so -lopencv_gpu /usr/lib/x86_64-linux-gnu/libopencv_highgui.so -lopencv_highgui /usr/lib/x86_64-linux-gnu/libopencv_imgproc.so -lopencv_imgproc /usr/lib/x86_64-linux-gnu/libopencv_legacy.so -lopencv_legacy /usr/lib/x86_64-linux-gnu/libopencv_ml.so -lopencv_ml /usr/lib/x86_64-linux-gnu/libopencv_objdetect.so -lopencv_objdetect /usr/lib/x86_64-linux-gnu/libopencv_ocl.so -lopencv_ocl /usr/lib/x86_64-linux-gnu/libopencv_photo.so -lopencv_photo /usr/lib/x86_64-linux-gnu/libopencv_stitching.so -lopencv_stitching /usr/lib/x86_64-linux-gnu/libopencv_superres.so -lopencv_superres /usr/lib/x86_64-linux-gnu/libopencv_ts.so -lopencv_ts /usr/lib/x86_64-linux-gnu/libopencv_video.so -lopencv_video /usr/lib/x86_64-linux-gnu/libopencv_videostab.so -lopencv_videostab</span><br></pre></td></tr></table></figure>



<p>通过这种方式就可以开始OpenCV的学习了，但是这样会很不方便吧，所以还是要在vs code中配置一套属于OpenCV的环境。</p>
<ul>
<li>配置vs code编译OpenCV程序的环境</li>
</ul>
<p>由上面的过程可以知道，究其原因就是之前的vs code设置的默认指令不匹配造成。同时也知道正确的指令应该是<code>g++ main.cpp -o main_test.out &#39;pkg-config --cflags --libs opencv&#39;</code>。<br>配置vs code的环境大同小异，这里简述一下：</p>
<blockquote>
<p>1.新建文件夹LearningOpenCV<br>2.在根目录下新建.vscode文件夹，并在该文件夹下新建launch.json,settings.json,tasks.json三个设置文件<br>3.其中launch.json,settings.json的设置可以参考其他，重要的是tasks.json中args参数的设置，这个是默认指令的设置。我的tasks.json设置如下：</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class="line">    <span class="comment">// for the documentation about the tasks.json format</span></span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"2.0.0"</span>,</span><br><span class="line">    <span class="string">"tasks"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"label"</span>: <span class="string">"build"</span>,</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">            <span class="string">"command"</span>: <span class="string">"g++"</span>,</span><br><span class="line">            <span class="string">"args"</span>:[<span class="string">"-g"</span>,<span class="string">"$&#123;workspaceRoot&#125;/main.cpp"</span>,<span class="string">"-o"</span>,<span class="string">"main_test.out"</span>,<span class="string">"`pkg-config"</span>,<span class="string">"--cflags"</span>,<span class="string">"--libs"</span>,<span class="string">"opencv`"</span>],</span><br><span class="line">            <span class="string">"presentation"</span>: &#123;</span><br><span class="line">                <span class="string">"reveal"</span>: <span class="string">"always"</span>,</span><br><span class="line">                <span class="string">"panel"</span>: <span class="string">"new"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"problemMatcher"</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"owner"</span>: <span class="string">"cpp"</span>,</span><br><span class="line">                <span class="string">"fileLocation"</span>:[<span class="string">"relative"</span>, <span class="string">"$&#123;workspaceRoot&#125;"</span>],</span><br><span class="line">                <span class="string">"pattern"</span>:[</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"regexp"</span>: <span class="string">"^([^\\\\s].*)\\\\((\\\\d+,\\\\d+)\\\\):\\\\s*(.*)$"</span>,</span><br><span class="line">                        <span class="string">"file"</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="string">"line"</span>: <span class="number">2</span>,</span><br><span class="line">                        <span class="string">"column"</span>: <span class="number">3</span>,</span><br><span class="line">                        <span class="string">"severity"</span>: <span class="number">4</span>,</span><br><span class="line">                        <span class="string">"location"</span>: <span class="number">2</span>,</span><br><span class="line">                        <span class="string">"message"</span>: <span class="number">5</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到tasks.json中的args参数正是我们上面说到的终端指令。<br><strong>注意</strong>：由于args的参数设置时不能包含空格，所以<code>pkg-config --cflags --libs opencv</code>需要不同的引号分开，同时`注意不要搞错或者忘记。<br>到此为止，vs code的OpenCV编译环境已经完成了，接下来就在Ubuntu下面开始OpenCV的学习吧！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tramac.github.io/2020/07/17/Finetuning%20with%20Tensorflow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Tramac">
      <meta itemprop="description" content="Tramac写字的地方">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tramac's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/07/17/Finetuning%20with%20Tensorflow/" class="post-title-link" itemprop="url">Finetuning with Tensorflow</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-17 14:16:08 / 修改时间：16:30:40" itemprop="dateCreated datePublished" datetime="2020-07-17T14:16:08+08:00">2020-07-17</time>
            </span>

          
            <span id="/blog/2020/07/17/Finetuning%20with%20Tensorflow/" class="post-meta-item leancloud_visitors" data-flag-title="Finetuning with Tensorflow" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>很多网络的特征提取部分都会用到fine-tunning,比如resnet-50,inception等,该文章以AlexNet为例,分析tensorflow如何进行微调</p>
<p><strong>finetuning的三要素:</strong></p>
<ul>
<li>预训练模型,如resnet_v2_50.npy、resnet_v2_50.ckpt等。</li>
<li>模型的网络结构定义。</li>
<li>所需从预训练模型中恢复的变量，通常以排除的方式给出。</li>
</ul>
<p><strong>Tips:</strong></p>
<ul>
<li><p>所定义网络结构中的变量名需要和预训练模型中的变量名保持相同。预训练模型中的变量名可有以下方式查看:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用tf.train.NewCheckpointReader直接读取ckpt文件里的变量</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.python <span class="keyword">import</span> pywrap_tensorflow</span><br><span class="line"></span><br><span class="line">reader = pywarp_tensorflow.NewCheckpointReader(checkpoint_path)</span><br><span class="line">var_to_shape_map = reader.get_variable_to_shape_map()</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> var_to_shape_map:</span><br><span class="line">    print(<span class="string">"tensor_name: "</span>, key)</span><br></pre></td></tr></table></figure>
</li>
<li><p>恢复部分变量时可借助slim。如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">variables_to_restore = slim.get_varibales_to_restore(exclude=[args.resnet_model] + <span class="string">"logits"</span>, <span class="string">"optimizer_vars"</span>,  <span class="string">"DeepLab_v3/ASPP_layer"</span>, <span class="string">"DeepLab_v3/logits"</span>])</span><br><span class="line">restorer = tf.train.Saver(variables_to_restore)</span><br><span class="line">restorer.restore(sess, <span class="string">"./resnet/checkpoints/"</span> + args.resnet_model + <span class="string">"./ckpt"</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tramac.github.io/2020/07/17/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83-PyTorch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Tramac">
      <meta itemprop="description" content="Tramac写字的地方">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tramac's Space">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/07/17/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83-PyTorch/" class="post-title-link" itemprop="url">分布式训练-PyTorch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-17 13:13:21 / 修改时间：16:29:44" itemprop="dateCreated datePublished" datetime="2020-07-17T13:13:21+08:00">2020-07-17</time>
            </span>

          
            <span id="/blog/2020/07/17/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83-PyTorch/" class="post-meta-item leancloud_visitors" data-flag-title="分布式训练-PyTorch" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>并行训练（数据并行与模型并行）与分布式训练是深度学习中加速训练的两种常用方式，相对于并行训练，分布式是更优的加速方案，也是PyTorch官方推荐的方法：<br>Multi-Process Single-GPU<br>This is the highly recommended way to use DistributedDataParallel, with multiple processes, each of which operates on a single GPU. This is currently the fastest approach to do data parallel training using PyTorch and applies to both single-node(multi-GPU) and multi-node data parallel training. It is proven to be significantly faster than torch.nn.DataParallel for single-node multi-GPU data parallel training.</p>
<p>个人理解：分布式训练其实也是并行训练的一种方式，只是相对于数据并行、模型并行有所不同。简单来说，分布式针对多机多卡，而数据并行针对单机多卡。</p>
<h3 id="Distributed-Training-Code"><a href="#Distributed-Training-Code" class="headerlink" title="Distributed Training Code"></a>Distributed Training Code</h3><p>下面内容主要指出分布式训练代码中与常规训练过程之间的主要区别。</p>
<h4 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h4><p>分布式训练主要涉及到的库主要有<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.parallel.DistributedDataParallel" target="_blank" rel="noopener">torch.nn.parallel</a>，<a href="https://pytorch.org/docs/stable/distributed.html" target="_blank" rel="noopener">torch.distributed</a>，<a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.distributed.DistributedSampler" target="_blank" rel="noopener">torch.utils.data.distributed</a>以及<a href="https://pytorch.org/docs/stable/multiprocessing.html" target="_blank" rel="noopener">torch.multiprocessing</a>。需要注意的是我们需要把multiprocessing的start method设置为spawn或forkserver（仅Python3支持）,因为默认的方法为fork，容易导致死锁情况发生。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    torch.multiprocessing.set_start_method(<span class="string">'spawn'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.parallel</span><br><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist</span><br><span class="line"><span class="keyword">import</span> torch.optim</span><br><span class="line"><span class="keyword">import</span> torch.utils.data</span><br><span class="line"><span class="keyword">import</span> torch.utils.data.distributed</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> torchvision.datasets <span class="keyword">as</span> datasets</span><br><span class="line"><span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models</span><br></pre></td></tr></table></figure>

<h4 id="Train-Function"><a href="#Train-Function" class="headerlink" title="Train Function"></a>Train Function</h4><p>第一个区别，在分布式训练过程中，需要设置数据的<code>non_blocking</code>的属性设置为<code>True</code>。该操作使得不同GPU上的数据副本允许重叠计算，并且可以输出训练时的统计数据，以便我们可以跟踪整个训练过程的进度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(train_loader, model, criterion, optimizer, epoch)</span>:</span></span><br><span class="line">    <span class="comment"># switch to train mode</span></span><br><span class="line">    model.train()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, (input, target) <span class="keyword">in</span> enumerate(train_loader):</span><br><span class="line">        <span class="comment"># Create non_blocking tensors for distributed training</span></span><br><span class="line">        input = input.cuda(non_blocking=<span class="literal">True</span>)</span><br><span class="line">        target = target.cuda(non_blocking=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># compute output</span></span><br><span class="line">        output = model(input)</span><br><span class="line">        loss = criterion(output, target)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># compute gradients in a backward pass</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Call step of optimizer to update model params</span></span><br><span class="line">        optimizer.step()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">'Epoch: [&#123;0&#125;][&#123;1&#125;/&#123;2&#125;]\t'</span></span><br><span class="line">                  <span class="string">'Loss &#123;loss.val:.4f&#125; (&#123;loss.avg:.4f&#125;)'</span>.format(</span><br><span class="line">                  epoch, i, len(train_loader), loss=losses))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adjust_learning_rate</span><span class="params">(initial_lr, optimizer, epoch)</span>:</span></span><br><span class="line">    <span class="string">"""Sets the learning rate to the initial LR decayed by 10 every 30 epochs"""</span></span><br><span class="line">    lr = initial_lr * (<span class="number">0.1</span> ** (epoch // <span class="number">30</span>))</span><br><span class="line">    <span class="keyword">for</span> param_group <span class="keyword">in</span> optimizer.param_groups:</span><br><span class="line">        param_group[<span class="string">'lr'</span>] = lr</span><br></pre></td></tr></table></figure>

<h4 id="Validation-Function"><a href="#Validation-Function" class="headerlink" title="Validation Function"></a>Validation Function</h4><p>与训练过程相同，唯一的区别是获取数据时需要设置<code>non_blocking=True</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validation</span><span class="params">(val_loader, model, criterion)</span>:</span></span><br><span class="line">    <span class="comment"># switch to evaluate mode</span></span><br><span class="line">    model.eval()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> i, (input, target) <span class="keyword">in</span> enumerate(val_loader):</span><br><span class="line">            input = input.cuda(non_blocking=<span class="literal">True</span>)</span><br><span class="line">            target = target.cuda(non_blocking=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># compute output</span></span><br><span class="line">            output = model(input)</span><br><span class="line">            loss = criterion(output, target)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">'Test: [&#123;0&#125;/&#123;1&#125;]\t'</span></span><br><span class="line">                      <span class="string">'Loss &#123;loss.val:.4f&#125; (&#123;loss.avg:.4f&#125;))'</span>.format(</span><br><span class="line">                       i, len(val_loader), loss=losses))</span><br></pre></td></tr></table></figure>

<h4 id="Inputs"><a href="#Inputs" class="headerlink" title="Inputs"></a>Inputs</h4><p>相对于标准模型训练，分布式训练在定义数据输入时也略有不同，有些参数为分布式训练任务特定的。参数说明如下：</p>
<ul>
<li><strong>batch_size</strong>-batch size for <em>each</em> process in the distributed training group. Total batch size across distributed model is batch_size*world_size</li>
<li><strong>workers</strong> - number of worker processes used with the dataloaders in each process</li>
<li><strong>num_epochs</strong> - total number of epochs to train for</li>
<li><strong>starting_lr</strong> - starting learning rate for training</li>
<li><strong>world_size</strong> - number of processes in the distributed training environment</li>
<li><strong>dist_backend</strong> - backend to use for distributed training communication (i.e. NCCL, Gloo, MPI, etc.). In this tutorial, since we are using several multi-gpu nodes, NCCL is suggested.</li>
<li><strong>dist_url</strong> - URL to specify the initialization method of the process group. This may contain the IP address and port of the rank0 process or be a non-existant file on a shared file system. Here, since we do not have a shared file system this will incorporate the <strong>node0-privateIP</strong> and the port on node0 to use.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Collect Inputs..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Batch Size for training and testing</span></span><br><span class="line">batch_size = <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of additional worker processes for dataloading</span></span><br><span class="line">workers = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of epochs to train for</span></span><br><span class="line">num_epochs = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Starting Learning Rate</span></span><br><span class="line">starting_lr = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of distributed processes</span></span><br><span class="line">world_size = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Distributed backend type</span></span><br><span class="line">dist_backend = <span class="string">'nccl'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Url used to setup distributed training</span></span><br><span class="line">dist_url = <span class="string">"tcp://172.31.22.234:23456"</span></span><br></pre></td></tr></table></figure>

<h4 id="Initialize-process-group"><a href="#Initialize-process-group" class="headerlink" title="Initialize process group"></a>Initialize process group</h4><ol>
<li><p>设置进程组。该过程可由函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.distributed.init_process_group</span><br></pre></td></tr></table></figure>

<p>实现。函数的参数说明如下：</p>
<ul>
<li><strong>backend</strong>-the backend to use (i.e. NCCL, Gloo, MPI, etc.)</li>
<li><strong>init_method</strong>-which is either a url containing the address and port of the rank0 machine or a path to a non-existant file on the shared file system. Note, to use the file init_method, all machines must have access to the file, similarly for the url method, all machines must be able to communicate on the network so make sure to configure any firewalls and network settings to accomodate.</li>
<li><strong>rank</strong>-the rank of this process when run</li>
<li><strong>world_size</strong>-the number of processes in the collective<br>The <em>init_method</em> input can also be “env://”. In this case, the address and port of the rank0 machine will be read from the following two environment variables respectively: MASTER_ADDR, MASTER_PORT. If <em>rank*and *world_size</em> arguments are not specified in the <em>init_process_group</em> function, they both can be read from the following two environment variables respectively as well: RANK, WORLD_SIZE.</li>
</ul>
</li>
<li><p>设置进程的lock_rank。该操作用于为进程指定设备（即使用哪个GPU），同时也用于创建分布式数据并行模型时指定设备。</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Initialize Process Group..."</span>)</span><br><span class="line"><span class="comment"># Initialize Process Group</span></span><br><span class="line"><span class="comment"># v1 - init with url</span></span><br><span class="line">dist.init_process_group(backend=dist_backend, init_method=dist_url, rank=int(sys.argv[<span class="number">1</span>]), world_size=world_size)</span><br><span class="line"><span class="comment"># v2 - init with file</span></span><br><span class="line"><span class="comment"># dist.init_process_group(backend="nccl", init_method="file:///home/ubuntu/pt-distributed-tutorial/trainfile", rank=int(sys.argv[1]), world_size=world_size)</span></span><br><span class="line"><span class="comment"># v3 - init with environment variables</span></span><br><span class="line"><span class="comment"># dist.init_process_group(backend="nccl", init_method="env://", rank=int(sys.argv[1]), world_size=world_size)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Establish Local Rank and set device on this node</span></span><br><span class="line">local_rank = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">dp_device_ids = [local_rank]</span><br><span class="line">torch.cuda.set_device(local_rank)</span><br></pre></td></tr></table></figure>

<h4 id="Initialize-Model"><a href="#Initialize-Model" class="headerlink" title="Initialize Model"></a>Initialize Model</h4><p>在定义模型时，需要将其指定为分布式模式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Initialize Model..."</span>)</span><br><span class="line"><span class="comment"># Construct Model</span></span><br><span class="line">model = models.resnet18(pretrained=<span class="literal">False</span>).cuda()</span><br><span class="line"><span class="comment"># Make model DistributedDataParallel</span></span><br><span class="line">model = torch.nn.parallel.DistributedDataParallel(model, device_ids=dp_device_ids, output_device=local_rank)</span><br><span class="line"></span><br><span class="line"><span class="comment"># define loss function (criterion) and optimizer</span></span><br><span class="line">criterion = nn.CrossEntropyLoss().cuda()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), starting_lr, momentum=<span class="number">0.9</span>, weight_decay=<span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Initialize-Dataloaders"><a href="#Initialize-Dataloaders" class="headerlink" title="Initialize Dataloaders"></a>Initialize Dataloaders</h4><p>分布式训练的最后一个特定情况是将训练数据指定为DistributedSampler，与DistributedDataParallel模型结合使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"Initialize Dataloaders..."</span>)</span><br><span class="line">transform = transforms.Compose(</span><br><span class="line">    [transforms.Resize(<span class="number">224</span>),</span><br><span class="line">     transforms.ToTensor(),</span><br><span class="line">     transforms.Normalize((<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>), (<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>))])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize Datasets. STL10 will automatically download if not present</span></span><br><span class="line">trainset = datasets.STL10(root=<span class="string">'./data'</span>, split=<span class="string">'train'</span>, download=<span class="literal">True</span>, transform=transform)</span><br><span class="line">valset = datasets.STL10(root=<span class="string">'./data'</span>, split=<span class="string">'test'</span>, download=<span class="literal">True</span>, transform=transform)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create DistributedSampler to handle distributing the dataset across nodes when training</span></span><br><span class="line"><span class="comment"># This can only be called after torch.distributed.init_process_group is called</span></span><br><span class="line">train_sampler = torch.utils.data.distributed.DistributedSampler(trainset)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the Dataloaders to feed data to the training and validation steps</span></span><br><span class="line">train_loader = torch.utils.data.DataLoader(trainset, batch_size=batch_size, shuffle=(train_sampler <span class="keyword">is</span> <span class="literal">None</span>), num_workers=workers, pin_memory=<span class="literal">False</span>, sampler=train_sampler)</span><br><span class="line">val_loader = torch.utils.data.DataLoader(valset, batch_size=batch_size, shuffle=<span class="literal">False</span>, num_workers=workers, pin_memory=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Training-Loop"><a href="#Training-Loop" class="headerlink" title="Training Loop"></a>Training Loop</h4><p>开始训练，与标准模型训练唯一的不同的需要更新DistributedSampler的epoch。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(num_epochs):</span><br><span class="line">    <span class="comment"># Set epoch count for DistributedSampler</span></span><br><span class="line">    train_sampler.set_epoch(epoch)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Adjust learning rate according to schedule</span></span><br><span class="line">    adjust_learning_rate(starting_lr, optimizer, epoch)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># train for one epoch</span></span><br><span class="line">    print(<span class="string">"\nBegin Training Epoch &#123;&#125;"</span>.format(epoch+<span class="number">1</span>))</span><br><span class="line">    train(train_loader, model, criterion, optimizer, epoch)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># evaluate on validation set</span></span><br><span class="line">    print(<span class="string">"Begin Validation @ Epoch &#123;&#125;"</span>.format(epoch+<span class="number">1</span>))</span><br><span class="line">    validate(val_loader, model, criterion)</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>PyTorch中，分布式训练相对于标准训练主要有以下几点不同：</p>
<ul>
<li>更改输入数据的<code>non_blocking</code>属性。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">input = input.cuda(non_blocking=<span class="literal">True</span>)</span><br><span class="line">target = target.cuda(non_blocking=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>初始化进程组，设置local rank</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dist.init_process_group(backend=dist_backend, init_method=dist_url, rank=int(sys.argv[<span class="number">1</span>]), world_size=world_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Establish Local Rank and set device on this node</span></span><br><span class="line">local_rank = int(sys.argv[<span class="number">2</span>])</span><br><span class="line">dp_device_ids = [local_rank]</span><br><span class="line">torch.cuda.set_device(local_rank)</span><br></pre></td></tr></table></figure>

<ul>
<li>指定模型为分布式数据并行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = torch.nn.parallel.DistributedDataParallel(model, device_ids=dp_device_ids, output_device=local_rank)</span><br></pre></td></tr></table></figure>

<ul>
<li>指定数据集为分布式样本</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_sampler = torch.utils.data.distributed.DistributedSampler(trainset)</span><br></pre></td></tr></table></figure>

<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h3><ul>
<li><a href="https://pytorch.org/tutorials/intermediate/dist_tuto.html#writing-distributed-applications-with-pytorch" target="_blank" rel="noopener">PYTORCH 1.0 DISTRIBUTED TRAINER WITH AMAZON AWS</a></li>
<li><a href="https://github.com/seba-1511/dist_tuto.pth" target="_blank" rel="noopener">PyTorch Distributed Tutorial</a></li>
<li><a href="https://github.com/pytorch/examples/tree/master/imagenet" target="_blank" rel="noopener">PyTorch ImageNet Example</a></li>
<li><a href="https://blog.csdn.net/zwqjoy/article/details/89415933" target="_blank" rel="noopener">Pytorch 1.0 分布式训练初探</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tramac"
      src="/blog/images/avatar.png">
  <p class="site-author-name" itemprop="name">Tramac</p>
  <div class="site-description" itemprop="description">Tramac写字的地方</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Tramac" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Tramac" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/qia-ka-ka-23" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;qia-ka-ka-23" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tramac@yeah.net" title="E-Mail → mailto:tramac@yeah.net" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tramac</span>
</div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"EwM0rzNJJvrzOMGM9QtRQabg-gzGzoHsz","app_key":"Cgarq2zhnKAf5zzYVctu26G2","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
</body>
</html>
